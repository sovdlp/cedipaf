{"version":3,"sources":["../../../src/components/VDialog/VDialog.tsx"],"names":["VDialogTransition","VOverlay","makeDimensionProps","useDimension","makeTransitionProps","useProxiedModel","useScopeId","nextTick","ref","watch","genericComponent","IN_BROWSER","VDialog","name","inheritAttrs","props","fullscreen","Boolean","origin","type","String","default","retainFocus","scrollable","modelValue","width","transition","component","emits","value","setup","attrs","slots","isActive","dimensionStyles","scopeId","overlay","onFocusin","e","before","relatedTarget","after","target","contentEl","isTop","document","includes","contains","focusable","querySelectorAll","filter","el","hasAttribute","length","firstElement","lastElement","focus","val","addEventListener","removeEventListener","immediate","preventScroll","activatorEl","activator"],"mappings":"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","sourcesContent":["// Styles\nimport './VDialog.sass'\n\n// Components\nimport { VDialogTransition } from '@/components/transitions'\nimport { VOverlay } from '@/components/VOverlay'\n\n// Composables\nimport { makeDimensionProps, useDimension } from '@/composables/dimensions'\nimport { makeTransitionProps } from '@/composables/transition'\nimport { useProxiedModel } from '@/composables/proxiedModel'\nimport { useScopeId } from '@/composables/scopeId'\n\n// Utilities\nimport { nextTick, ref, watch } from 'vue'\nimport { genericComponent, IN_BROWSER } from '@/util'\n\n// Types\nimport type { OverlaySlots } from '@/components/VOverlay/VOverlay'\n\nexport const VDialog = genericComponent<new () => {\n  $slots: OverlaySlots\n}>()({\n  name: 'VDialog',\n\n  inheritAttrs: false,\n\n  props: {\n    fullscreen: Boolean,\n    origin: {\n      type: String,\n      default: 'center center',\n    },\n    retainFocus: {\n      type: Boolean,\n      default: true,\n    },\n    scrollable: Boolean,\n    modelValue: Boolean,\n\n    ...makeDimensionProps({ width: 'auto' }),\n    ...makeTransitionProps({\n      transition: { component: VDialogTransition },\n    }),\n  },\n\n  emits: {\n    'update:modelValue': (value: boolean) => true,\n  },\n\n  setup (props, { attrs, slots }) {\n    const isActive = useProxiedModel(props, 'modelValue')\n    const { dimensionStyles } = useDimension(props)\n    const { scopeId } = useScopeId()\n\n    const overlay = ref<VOverlay>()\n    function onFocusin (e: FocusEvent) {\n      const before = e.relatedTarget as HTMLElement | null\n      const after = e.target as HTMLElement | null\n\n      if (\n        before !== after &&\n        overlay.value?.contentEl &&\n        // We're the topmost dialog\n        overlay.value?.isTop &&\n        // It isn't the document or the dialog body\n        ![document, overlay.value.contentEl].includes(after!) &&\n        // It isn't inside the dialog body\n        !overlay.value.contentEl.contains(after)\n      ) {\n        const focusable = [...overlay.value.contentEl.querySelectorAll(\n          'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n        )].filter(el => !el.hasAttribute('disabled')) as HTMLElement[]\n\n        if (!focusable.length) return\n\n        const firstElement = focusable[0]\n        const lastElement = focusable[focusable.length - 1]\n\n        if (before === firstElement) {\n          lastElement.focus()\n        } else {\n          firstElement.focus()\n        }\n      }\n    }\n\n    if (IN_BROWSER) {\n      watch(() => isActive.value && props.retainFocus, val => {\n        val\n          ? document.addEventListener('focusin', onFocusin)\n          : document.removeEventListener('focusin', onFocusin)\n      }, { immediate: true })\n    }\n\n    watch(isActive, async val => {\n      await nextTick()\n      if (val) {\n        overlay.value!.contentEl?.focus({ preventScroll: true })\n      } else {\n        overlay.value!.activatorEl?.focus({ preventScroll: true })\n      }\n    })\n\n    return () => {\n      return (\n        <VOverlay\n          v-model={ isActive.value }\n          class={[\n            'v-dialog',\n            {\n              'v-dialog--fullscreen': props.fullscreen,\n              'v-dialog--scrollable': props.scrollable,\n            },\n          ]}\n          style={ dimensionStyles.value }\n          transition={ props.transition }\n          ref={ overlay }\n          aria-role=\"dialog\"\n          aria-modal=\"true\"\n          activatorProps={{\n            'aria-haspopup': 'dialog',\n            'aria-expanded': String(isActive.value),\n          }}\n          z-index={ 2400 }\n          { ...scopeId }\n          { ...attrs }\n          v-slots={{\n            default: slots.default,\n            activator: slots.activator,\n          }}\n        />\n      )\n    }\n  },\n})\n\nexport type VDialog = InstanceType<typeof VDialog>\n"],"file":"VDialog.mjs"}